# Issue #108: ヒンジシーンの Storybook と Play テストを整備する

## Issueスナップショット
- URL: https://github.com/soma-arc/hyperbolic-plane-tile-poc/issues/108
- ラベル: type:task, area:ui

### 目的
ヒンジシーンを Storybook 上で操作・検証できるようにし、自由端ドラッグと固定ヒンジ不動を自動テストで担保する。

### In / Out
In: hinge シーン用 CSF3 ストーリー, Docs/Controls の更新, Play テスト（自由端可動・固定ヒンジ不動）, アクセシビリティ配慮  
Out: 4枚鏡シーンのデモ, ビルド設定変更

### 完了条件 (DoD)
- [ ] ヒンジシーンを表示する Storybook ストーリーを追加し Docs に操作手順を記載する
- [ ] Controls でハンドル可視化や固定状態を切り替えられる
- [ ] Play テストで自由端ドラッグ時の法線更新と固定ヒンジが動かないことを検証する
- [ ] Play 実行を含む `pnpm test-storybook` または同等チェックが緑化する

### テスト観点
- Storybook Play で pointer 操作シミュレーションが成功する
- Docs ページのアクセシビリティチェックがエラーなしで通る

---

## 実装計画（plan.md 抜粋ベース）

### 現状整理
- ヒンジシーン実装後、UI 操作や固定ポイント無視ロジックを Storybook で可視化する必要がある。
- Storybook 既存の HalfPlaneStage は独立制御点を前提にしており、共有制御点の扱いが未対応。

### スコープ
1. 新ヒンジシーンの CSF3 ストーリーを作成し、Docs ページに操作手順と固定ハンドル情報を明記。
2. Controls でハンドル表示・固定切替などを操作できるよう整備。
3. Storybook Play テストで自由端ドラッグが回転を引き起こし、固定ヒンジが動かないことを検証。
4. Storybook 上でアクセシビリティ属性（ラベル/フォーカス）を確認。

### 実装ステップ案
1. **ストーリーファイルの作成**
   - `HalfPlaneStage` 系のストーリーを再利用しつつ、ヒンジシーン専用の state 管理を追加。
   - Docs タブにシーン概要と操作説明を記載。

2. **Controls 整備**
   - ハンドル表示トグル、固定ヒンジ色/形状の確認、plane drag 無効メッセージなどを提供。

3. **Play テスト**
   - `userEvent.pointer` で自由端ドラッグ→回転角度変化を確認。
   - 固定ヒンジハンドルをドラッグしても変化しないことを assertion。

4. **アクセシビリティ確認**
   - Storybook Doc の role/aria 属性を確認。必要なら `@storybook/test` の `axe` チェックを組み込む。

### リスクと対策
- Play テストが Canvas 描画に依存するため、DOM 属性で検証できるメタ情報（例: ハンドル座標 or class）を export する必要あり。
- 実行時間増加を抑えるため、テストは必要最小限の pointer 操作と assertion に限定。

### 残オープンクエスチョン
- なし（Storybook 操作要件はIssue本文で確定済み）。
