# Issue #112: クエリパラメータ経由のシーン埋め込み対応

## Issueスナップショット
- URL: https://github.com/soma-arc/hyperbolic-plane-tile-poc/issues/112
- ラベル想定: type:feature, area:ui

### 目的
外部プレゼン資料やドキュメントからクエリパラメータで任意シーンを指定し、16:9 の iframe に埋め込んだ状態で表示できるようにする。埋め込み時は最小限の UI を残し、閲覧者が操作しなくてもコンテンツが意図通りに見えることを保証する。

### In / Out
- In: クエリパラメータ解析、埋め込みレイアウト（16:9）、UI 簡素化、SceneDefinition とのマッピング、ドキュメント更新、テスト。
- Out: 新規シーンの追加、プレゼン用スタイルテーマの大規模刷新、外部ホスティング構成の変更。

### 完了条件 (DoD)
- [ ] `?scene=<SceneId>` で App 起動時に対応するシーンが自動選択される。
- [ ] `?embed=1`（または同等のフラグ）指定時に 16:9 のレスポンシブレイアウトに切り替わり、コントロール類が非表示になる。
- [ ] 無効なクエリが与えられた場合は安全にフォールバックし、利用可能なシーン一覧を提示する。
- [ ] Storybook / Vitest でクエリパラメータ挙動が自動テストされる。
- [ ] README または Docs に埋め込み手順とパラメータ仕様が記載される。

---

## 要件詳細

### 1. クエリパラメータ仕様
- `scene=<SceneId>`: `SceneDefinition` で定義済みの ID を受け入れる（例: `euclidean-regular-hexagon`）。値はホワイトリスト方式でバリデーション。
- `embed=1`（または `mode=embed`）: 埋め込みビューを有効化。将来拡張を見据えて布石を残す。
- オプション: `depth`, `geometry`, `n` など既存 UI で設定可能な値は将来的な対応余地として設計書に明記（今回の実装は `scene` と `embed` を優先）。
- クエリはページ初期化時に読み取り、`history.replaceState` / `pushState` を利用して UI 操作後も URL と状態を同期する。

### 2. 埋め込みレイアウト
- 16:9 レスポンシブ (例: `width: 100%`, `padding-top: 56.25%` を用いたアスペクト比ボックス) を実現。
- iframe 埋め込み時にスクロールバーや余白が出ないよう `body`, `html`, `#root` を 100% 化。
- 通常モードとスタイルが干渉しないよう、埋め込み用の CSS クラス（例: `.embed-mode`）を付与。

### 3. UI 簡素化 & アクセシビリティ
- 埋め込み時はモード切替、パラメータフォーム、プリセット、スナップ操作などを非表示化。
- 必要最小限の表示要素（Canvas、凡例があればテキスト）だけを残す。
- キーボードフォーカスで隠れた要素に移動しないよう、`tabIndex=-1` or `aria-hidden` を適用。

### 4. SceneDefinition 連携
- 新規 `SceneId` が追加されても自動でクエリ解析対象となるよう、`SCENE_IDS` / `listScenes()` ベースのルックアップを使用。
- 不正 ID の場合はデフォルトシーンにフォールバックし、可能ならトーストもしくはデバッグログで通知。

### 5. 状態管理 & ナビゲーション
- React 側では `useEffect` を用いて初期マウント時にクエリ解析。`EuclideanSceneHost` の `activeSceneId` 初期値に反映。
- シーン切替/埋め込みモード解除時にクエリも更新し、リロードしても状態が維持されるようにする。
- `embed` モード時は Euclidean/Hyperbolic 切替操作を無効化 or 常に URL 指定のジオメトリを使用する設計に。仕様どおり UI を非表示にするならデフォルトで disable。

### 6. テスト観点
- ユニットテスト: クエリ→シーン ID 解決、無効値フォールバック、`embed` フラグで UI コンポーネントが非表示になるかをテスト（React Testing Library / Vitest）。
- Storybook: iframe 埋め込みを模擬するストーリーを用意し、`<iframe srcdoc>` などで 16:9 表示を再現。Play Function でクエリを差し込んだレンダリングを検証。
- Chromatic などのビジュアルリグレッションで埋め込み表示が崩れていないか確認できるよう Storybook 側に制御フラグを追加。

### 7. ドキュメント更新
- README.md もしくは Docs セクションに埋め込み手順、使用可能な `SceneId` 一覧、埋め込み時の注意点を追記。
- Storybook Docs にも外部埋め込みガイドリンクを掲載。

### 8. 互換性・リスク
- 現在の UI レイアウトへの影響を最小化するため、`embed` クラス付与でスタイルを分岐。
- URL クエリ長制限を考慮し、値は短く保つ。
- エラー時に真っ白にならないようデフォルト描画を保証。

## リスク・留意点
- プロジェクター解像度など実運用環境での見え方確認が必要。
- iframe 内でのフォーカス制御・アクセシビリティ要件が追加で発生する可能性。
- iframe 外部からの悪意あるクエリを想定し、未定義 ID や長い文字列でも落ちない安全性が必要。

---
上記要件を基に実装 Issue を切り、設計レビュー後に着手する。
