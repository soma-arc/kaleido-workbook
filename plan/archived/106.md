# Issue #106: シーン定義レイヤと選択 UI を分離する

## Issueスナップショット
- URL: https://github.com/soma-arc/hyperbolic-plane-tile-poc/issues/106
- ラベル: type:task, area:ui

### 目的
三角形シーンとヒンジシーンを切り替えられる SceneDefinition 層を整備し、App の責務を分離する。

### In / Out
In: SceneDefinition 型と SceneController 的ホスト, サイドバーへのシーン選択 UI, 既存三角形シーンの移植  
Out: ヒンジシーン固有挙動, Storybook 更新, レンダリングスタイル変更

### 完了条件 (DoD)
- [ ] SceneDefinition（名称・初期半平面・制御情報）を定義し App から参照できる
- [ ] シーン切替 UI で Euclidean/Hyperbolic 含む既存機能が従来通りに動作する
- [ ] `pnpm test` / `pnpm typecheck` / `pnpm biome:ci` が緑化する

### テスト観点
- App レンダリングテストで三角形シーン選択時に既存パラメータ UI が表示される
- シーン切替操作でレンダリングが再描画されることのスナップショット

---

## 実装計画（plan.md 抜粋ベース）

### 現状整理
- `src/ui/App.tsx` が三角形生成・半平面編集・描画リクエストを一括管理しており、シーン概念が欠けている。
- 三角形パラメータ関連 UI が App に直接埋め込まれているため、別シーンの導入が困難。

### スコープ
1. シーンを表現する `SceneDefinition` 型と、切替制御を担う `SceneController`（仮称）を作成。
2. 既存の三角形シーン（Hyperbolic/Euclidean）を SceneDefinition 経由で起動するようリファクタリング。
3. App のサイドバーにシーン選択 UI を追加し、選択に応じて SceneHost を差し替える。

### 実装ステップ案
1. **シーン定義の導入**
   - `SceneDefinition` に識別子、名称、初期状態、利用するコントロール、描画モードなどを定義。
   - 既存の三角形シーン設定から必要情報を抽出し、この型に合わせて整理。

2. **SceneHost の分離**
   - `EuclideanSceneHost` と `HyperbolicSceneHost` を作成し、シーンに応じて必要な UI/ロジックをカプセル化。
   - App からは Host を選択してレンダリングするだけの構造に変更。

3. **シーン選択 UI**
   - サイドバーへセレクタ（ラジオ/セレクト）を追加し、選択変更で SceneDefinition を切り替える。
   - Hyperbolic → Triangle パラメータフォーム、Euclidean → 半平面編集 UI など既存構成を保持。

4. **既存機能の回帰確認**
   - パラメータ変更、ドラッグ操作、描画更新など現行フローが維持されているかを手動/テストで確認。

### リスクと対策
- App の依存度が高いため、段階的な移行と豊富なレンダリングテストで回帰を防ぐ。
- SceneHost 間の props 契約を明文化し、Hyperbolic/Euclidean それぞれの挙動差異を確認。

### 残オープンクエスチョン
- なし（plan.md で必要な確認事項は解決済み）。
