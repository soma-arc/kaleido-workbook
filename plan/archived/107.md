# Issue #107: ヒンジ固定の2枚鏡シーンを実装する

## Issueスナップショット
- URL: https://github.com/soma-arc/hyperbolic-plane-tile-poc/issues/107
- ラベル: type:task, area:ui

### 目的
原点ヒンジで 2 枚の半平面を操作できるシーンを追加し、自由端ドラッグによる回転と固定ヒンジの視覚化を実現する。

### In / Out
In: ヒンジシーンの SceneDefinition 追加, 自由端ドラッグによる法線再計算, 固定ハンドルの色・四角表示, plane drag 無効化構造  
Out: 4枚鏡シーンの実装, plane drag の再提供

### 完了条件 (DoD)
- [ ] ヒンジシーン初期状態が原点ヒンジかつ 90 度の半平面配置になる
- [ ] 自由端ドラッグでヒンジを通る直線に更新され、ヒンジ自体はドラッグで動かない
- [ ] 固定ハンドルが色付き四角として描画される
- [ ] ユニットテストでヒンジ固定と自由端回転が検証される

### テスト観点
- euclideanHalfPlaneDrag 系の新規テストでヒンジ固定を確認
- RenderEngine モックで handles 表示の色・形状を確認

---

## 実装計画（plan.md 抜粋ベース）

### 現状整理
- 制御点グラフは Issue #105 で整備済み。ヒンジ制御点は固定とする要件が確定済み。
- plane drag は本シーンでは不要だが、後から再利用できるよう制御フラグを残す必要がある。

### スコープ
1. 90 度構成のヒンジシーン（SceneDefinition）を追加し、原点ヒンジを固定制御点として登録。
2. 自由端ドラッグで半平面法線を更新するロジックを追加し、ヒンジ共有制御点は移動不可にする。
3. 固定制御点をUI上で四角＋別色表示に変更し、編集中も視覚的に区別。
4. plane drag の無効化設定をシーン側から指定できるようにする。

### 実装ステップ案
1. **SceneDefinition 拡張**
   - ヒンジシーン専用設定（初期半平面・制御点割当て・handle表示設定）を追加。
   - plane drag を抑止するフラグを SceneDefinition に追加し、ドラッグハンドラで参照。

2. **ドラッグロジック更新**
   - `euclideanHalfPlaneDrag` / `halfPlaneControlPoints` に共有制御点を使った回転計算を追加。
   - ヒンジ点は fixed=true のため updateControlPoint が無視する状態を利用し、二次的な回転/平行移動を防ぐ。

3. **描画ハンドルのスタイル調整**
   - RenderEngine の handle overlay に固定ハンドル用の形状・色オプションを追加。
   - ヒンジシーンでは固定ハンドルを四角かつ指定色で描画。

4. **テスト**
   - `euclideanHalfPlaneDrag` にヒンジ共有点のテストを追加し、自由端のみ移動することを確認。
   - `halfPlaneControlPoints` の固定ポイント抑制テストを再利用。

### リスクと対策
- ヒンジシーンによる UI の追加が既存シーンに影響しないよう、SceneDefinition ごとに設定を分離。
- 固定ハンドル表示は Canvas レイヤに追加するため、スタイル差分を明示的に管理。

### 残オープンクエスチョン
- なし（plane drag は無効・原点固定・90度初期化など仕様確定済み）。
